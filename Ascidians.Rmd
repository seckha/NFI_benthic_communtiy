---
title: "Ascidians"
author: "Shannon Eckhardt"
date: "2023-06-04"
output: html_document
---

```{r}
rm(list=ls())
library(tidyverse)
library(dplyr)
library(readxl)
```

Import data
```{r}
benthic.data <- read_excel("Benthic_cover.xlsx")
```

Extract ascidian data
```{r}
ascidians.full <- benthic.data[, c("Image ID", "Image name", "TP", "Site", "Transect_ID", "Transect_no", "ASCD")]
```

Convert TP to date format
```{r}
month_year <- strsplit(ascidians.full$TP, "_")
month <- sapply(month_year, function(x) x[1])
year <- sapply(month_year, function(x) x[2])
months <- c("January", "February", "March", "April", "May", "June", "July",
            "August", "Sept", "October", "November", "Dec") 
            # Sept and Dec because that's how they're saved in ascidians.full
month_numeric <- match(month, months)
year_numeric <- as.numeric(year)
date <- as.Date(paste(year_numeric, month_numeric, "01", sep = "-"))

# Save the date in a new column, other than TP
ascidians.full$Date <- date
```


Group by time point and site
```{r}
# Summed up cover = how many is there
ascidians.sum <- ascidians.full %>%
  group_by(TP, Site, Date) %>%
  summarize(sum_cover = sum(ASCD))

# remove NAs first
ascidians.sum <- na.omit(ascidians.sum)

# order the TPs
ascidians.sum <- ascidians.sum %>%
  mutate(TP = factor(TP, levels = c("Dec_2020", "April_2021", "April_2022", "Sept_2022", "Dec_2022",  "April_2023"))) %>%
  arrange(TP)

# simple plot
ggplot(ascidians.sum, aes(x = TP, y = sum_cover, fill = Site)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Time point", y = "Count", fill = "Site") +
  ggtitle("Count of ascidians over time and per site") +
  theme_classic()


# Mean cover = on average, how many is there per TP and Site
# ascidians.mean <- 
```

Percent cover per transect and per site
Boxplots with SE
Dotplots with SE
```{r}
# pivot table
t.cover <- benthic.data %>% pivot_longer(c(Acanthastrea:Valspp), names_to = "Genera", values_to = "Cover")

# calculate sum of cover values for each quadrat
quadrat.sum.cover <- t.cover %>%
  group_by(TP, Site, Transect_ID, Transect_no) %>%
  summarize(quadrat_sum_cover = sum(Cover)) # logically each quadrat has a cover of 100 because there are 100 points

# calculate sum of cover values for each transect - rowSums
# make new column called percent_cover - multiply by 100 to get percent
transect.percent.cover <- t.cover %>%
  group_by(TP, Site, Transect_ID) %>%
  summarize(percent_cover = sum(Cover[Genera == "ASCD"]) / sum(Cover) * 100, .groups = "drop",
            SE= sd(percent_cover)/sqrt(n()))

# SE does not work- do I need to calculate percent_cover by quadrat and then get the mean per transect?

```


Calculate frequency of occurrence (presented as table with TP, Site and FOC) = proportion of transects that have them present (presence/absence) per TP = how widespread it could be in the bay
  For each site EB,SB, CB (then maybe group SB and EB as lagoon)
  
% frequency of ascidians = (# of quadrats where ascidians occur / total # of quadrats examined)* 100
```{r}
# number of quadrats where ascidians occur
# make new column - if ascidian Cover >= 1 -> present, otherwise absent
# then calculate length(ascd_occurrence == "yes")
ascd.occurr <- benthic.data %>%
  mutate(ascd_occurrence = ifelse(ASCD != 0, "present", "absent"))
# ascd.occurr$ascd_occurrence -> works

sum(ascd.occurr$ascd_occurrence == "present") # only 14 quadrats where ascidians occur??

# total number of quadrats observed
length(benthic.data$Transect_no)

# calculate FOC for each TRANSECT_ID
transect.foc <- ascd.occurr %>%
  group_by(TP, Site, Transect_ID) %>%
  summarize(foc = sum(ascd_occurrence == "present") / length(benthic.data$Transect_no))
# not sure if this length(benthic.data$Transect_no) is correct

# calculate FOC for each Site
site.foc <- ascd.occurr %>%
  group_by(TP, Site) %>%
  summarize(foc = sum(ascd_occurrence == "present") / length(benthic.data$Transect_no))
# do you still use Transect_no here?

# calculate FOC per TP
TP.foc <- ascd.occurr %>%
  group_by(TP) %>%
  summarize(foc = sum(ascd_occurrence == "present") / length(benthic.data$Transect_no))
```

  
Relative cover
- take out all hard coral substrate and not sand
- for anything that isn't coral or sand, what proportion is made up of ascidians
- how much of 100% is ascidian cover
- sum of ascidians divided by sum all other cover (including ascidians) minus hard coral and sand
- are they making up more cover than algae in some places

Observation: where are the ascidians growing on? + close-up photographs? which "species"?


